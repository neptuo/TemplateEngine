<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="Design/Styles/bootstrap.css" rel="stylesheet" />
    <link href="Design/Styles/bootstrap-theme.css" rel="stylesheet" />
    <link href="Design/Styles/My/Common.css" rel="stylesheet" />
    <link href="Design/Styles/My/Layout.css" rel="stylesheet" />

    <script src="Design/Scripts/jquery-1.9.1.js"></script>
    <script src="Design/Scripts/bootstrap.js"></script>

    <script src="Design/Scripts/Generated/Neptuo.System.Client.js"></script>

    <script src="Design/Scripts/Generated/Neptuo.js"></script>
    <script src="Design/Scripts/Generated/Neptuo.ObjectBuilder.js"></script>
    <script src="Design/Scripts/Generated/Neptuo.Bootstrap.js"></script>

    <script src="Design/Scripts/Generated/Neptuo.PresentationModels.js"></script>
    <script src="Design/Scripts/Generated/Neptuo.PresentationModels.TypeModels.DataAnnotations.js"></script>
    <script src="Design/Scripts/Generated/Neptuo.PresentationModels.TypeModels.js"></script>
    <script src="Design/Scripts/Generated/Neptuo.PresentationModels.Validation.js"></script>

    <script src="Design/Scripts/Generated/Neptuo.Templates.Components.js"></script>

    <script src="Design/Scripts/Generated/TemplateEngine/Neptuo.TemplateEngine.js"></script>
    <script src="Design/Scripts/Generated/TemplateEngine/Neptuo.TemplateEngine.Navigation.js"></script>
    <script src="Design/Scripts/Generated/TemplateEngine/Neptuo.TemplateEngine.Web.js"></script>
    <script src="Design/Scripts/Generated/TemplateEngine/Neptuo.TemplateEngine.Web.Client.js"></script>

    <script src="Design/Scripts/Generated/TemplateEngine/Accounts/Neptuo.TemplateEngine.Accounts.Shared.js"></script>

    <script>
        JsRuntime.Start();

        var objectBuilder = new Neptuo.ObjectBuilder.DependencyContainer.ctor();
        Neptuo.DependencyContainerExtensions.RegisterInstance$1(Neptuo.Templates.IComponentManager.ctor, objectBuilder, new Neptuo.Templates.ComponentManager.ctor());
        Neptuo.DependencyContainerExtensions.RegisterInstance$1(Neptuo.IDependencyProvider.ctor, objectBuilder, objectBuilder);
        Neptuo.TemplateEngine.Web.Client.InitScript.Init(objectBuilder);

        var viewActivator = objectBuilder.Resolve(Typeof(Neptuo.TemplateEngine.Web.Client.StaticViewActivator.ctor), null);

    </script>
    <script src="/views.ashx"></script>
    <script>

        function MapView(url) {
            if (url.indexOf("/Home.aspx") != -1) {
                return "~/Views/Home.view";
            }

            if (url.indexOf("/Accounts/UserList.aspx") != -1) {
                return "~/Views/Accounts/UserList.view";
            }
            if (url.indexOf("/Accounts/UserEdit.aspx") != -1) {
                return "~/Views/Accounts/UserEdit.view";
            }

            if (url.indexOf("/Accounts/RoleList.aspx") != -1) {
                return "~/Views/Accounts/RoleList.view";
            }
            if (url.indexOf("/Accounts/RoleEdit.aspx") != -1) {
                return "~/Views/Accounts/RoleEdit.view";
            }

            return null;
        }

        function OnLinkClick(e) {
            $this = $(this);
            var start = +new Date;

            var newUrl = $this.attr('href');
            var viewPath = MapView(newUrl);

            if (viewPath == null) {
                alert("No view for: " + newUrl);
                return;
            }

            var writer = new System.IO.StringWriter.ctor();
            var view = viewActivator.CreateView(viewPath);
            view.Setup(new Neptuo.Templates.BaseViewPage.ctor(objectBuilder.Resolve(Typeof(Neptuo.Templates.IComponentManager.ctor), null)), objectBuilder.Resolve(Typeof(Neptuo.Templates.IComponentManager.ctor), null), objectBuilder);
            view.CreateControls();
            view.Init();
            view.Render(new Neptuo.Templates.HtmlTextWriter.ctor(writer));
            view.Dispose();
            $("#target").html(writer.toString()).find('a').click(OnLinkClick);

            $("#measure").html((+new Date) - start + "ms");

            history.pushState(viewPath, $this.html(), newUrl);
            e.preventDefault();
        }

        $(function () {

            $("a").click(OnLinkClick);
        });
    </script>
</head>
<body>
    <div id="target"></div>
    <a href="/Accounts/UserList.aspx">User accounts</a>
    <a href="/Accounts/RoleList.aspx">User Roles</a>
    <div id="measure"></div>
</body>
</html>
